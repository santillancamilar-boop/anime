<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voces del Anime — Comunidad</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="styles.css" />
  <style>
  .compose .muted{ color:#4c1d95; font-weight:800; font-size:1.1rem; }
    :root{
      --ink:#111827; --brand:#5b21b6; --muted:#6b7280;
      --grad1:#f0abfc; --grad2:#93c5fd; --grad3:#a7f3d0;
      --page-max:1200px;
      --vio:#7c3aed;
    }
     *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--ink);
      background:linear-gradient(135deg,#fdf2f8,#eef2ff,#ecfdf5);
      background-attachment:fixed;
    }
    .container{max-width:var(--page-max);margin:0 auto;padding:0 16px}
    a{color:#6d28d9;text-decoration:none}

    /* NAV */
    .nav{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.7);backdrop-filter:blur(6px);border-bottom:1px solid #e9d5ff}
    .nav-inner{display:flex;align-items:center;gap:12px;padding:10px 0}
    .brand{font-weight:600;color:#6d28d9}
    .tabs{margin-left:auto;display:flex;gap:12px;flex-wrap:wrap}
    .tab{font-weight:500}
    .tab:hover,.tab:focus-visible{font-weight:600}
    .tab.active{font-weight:800;text-decoration:underline}

    /* HERO */
    .hero{padding:56px 0 64px}
    .hero-frame{max-width:var(--page-max);margin:0 auto;border-radius:18px;padding:1px;background:linear-gradient(135deg,var(--grad1),var(--grad2),var(--grad3));box-shadow:0 10px 24px rgba(0,0,0,.08)}
    .hero-glass{border-radius:18px;background:rgba(255,255,255,.65);backdrop-filter:blur(10px);text-align:center;padding:28px 32px}
    .hero h1{margin:0;color:var(--brand);font-size:clamp(26px,5vw,44px)}
    .lead{margin:6px auto 0;color:var(--muted);max-width:66ch;text-align:center}

    /* BLOQUES */
    .section{padding:1px 0}
    .frame{border-radius:18px;padding:1px;background:linear-gradient(135deg,var(--grad1),var(--grad2),var(--grad3));box-shadow:0 10px 24px rgba(0,0,0,.08);max-width:var(--page-max);margin-inline:auto}
    .glass{border-radius:18px;background:rgba(255,255,255,.65);backdrop-filter:blur(10px);padding:22px}
    @media(min-width:720px){.glass{padding:28px}}
    .title{font-weight:800;color:#4c1d95;margin:0 0 10px}
    .muted{color:#6b7280}

    /* GRID / CARDS */
    .grid-3{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:rgba(255,255,255,.9);border:1px solid #e9d5ff;border-radius:12px}
    .card-inner{padding:14px 16px}

    /* Publicar */
    .compose{background:rgba(255,255,255,.92);border:1px solid #e9d5ff;border-radius:12px;padding:14px 16px;margin-bottom:12px}
    .compose .row{display:grid;gap:10px;grid-template-columns:1fr}
    @media(min-width:680px){ .compose .row{grid-template-columns:180px 1fr 120px} }
    .compose input,.compose textarea{
      width:100%;border:1px solid #c7d2fe;border-radius:10px;padding:14px 16px;background:#fff;font:inherit
    }
    .compose textarea{min-height:70px;resize:vertical}
    .btn{
      border:1px solid var(--vio);background:var(--vio);color:#fff;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer
    }
    .btn.ghost{background:#fff;color:var(--vio)}
    .btn.small{padding:6px 10px;font-size:.9rem;border-radius:8px}
    .meta{font-size:.85rem;color:#6b7280;margin-top:6px}

    /* Acciones */
    .actions{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
    .sep{flex:1}

    /* Respuestas */
    .replies{margin-top:10px;border-top:1px dashed #e9d5ff;padding-top:8px}
    .reply{border:1px solid #e9d5ff;background:#fff;border-radius:10px;padding:10px 12px;margin-top:8px}
    .reply-form{display:grid;gap:8px;margin-top:10px}
    .reply-form input,.reply-form textarea{border:1px solid #c7d2fe;border-radius:10px;padding:8px 10px;background:#fff;font:inherit}

    /* Buscador */
    .searchbar{display:grid;gap:10px;grid-template-columns:1fr 120px;margin-bottom:12px}
    .searchbar input{border:1px solid #c7d2fe;border-radius:10px;padding:10px 12px;background:#fff;font:inherit}

    /* Edición */
    .edit-area{display:grid;gap:8px;margin-top:10px}
    .edit-area textarea{border:1px solid #c7d2fe;border-radius:10px;padding:10px 12px;background:#fff;font:inherit;min-height:70px}

    /* Autor destacado */
    .author{ color:#4c1d95 !important; font-weight:750; }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">Voces del Anime</a>
      <div class="tabs">
        <a class="tab" href="index.html">Inicio</a>
        <a class="tab" href="lengua.html">Lengua</a>
        <a class="tab" href="cultura.html">Cultura</a>
        <a class="tab active" href="comunidad.html">Comunidad</a>
        <a class="tab" href="recursos.html">Recursos</a>
      </div>
    </div>
  </div>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container">
        <div class="hero-frame">
          <div class="hero-glass">
            <h1>Comunidad</h1>
            <p class="lead">Intercambio de ideas, frases favoritas y propuestas de aprendizaje.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- CARD PRINCIPAL -->
    <section class="section">
      <div class="frame">
        <div class="glass">
          <!-- Buscador -->
          <div class="searchbar" aria-label="Buscador de publicaciones">
            <input id="searchInput" type="search" placeholder="Buscar por texto o autor..." />
            <button id="clearSearch" class="btn ghost">Limpiar</button>
          </div>

          <!-- Publicar -->
          <div class="compose" aria-label="Crear publicación">
            <p class="muted">¿Tenés dudas o sugerencias?</p>
            <div class="row">
              <input id="author" type="text" placeholder="Tu nombre (opcional)" aria-label="Tu nombre" />
              <textarea id="content" placeholder="Comparte una frase, duda o idea..." aria-label="Contenido de la publicación"></textarea>
              <button id="btnPost" class="btn">Publicar</button>
            </div>
            <div id="composeMsg" class="meta" role="status" aria-live="polite"></div>
          </div>

          <!-- Grid de posts -->
          <div id="postsGrid" class="grid-3" aria-live="polite"></div>
          <div id="emptyMsg" class="meta" style="display:none">No hay publicaciones que coincidan con la búsqueda.</div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER CORRECTO -->
  <footer>
    <div class="container" style="border-top:1px solid #e9d5ff;background:rgba(255,255,255,.65);">
      <div class="footer-inner" style="display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));padding:20px 0;color:#374151;max-width:var(--page-max);margin-inline:auto">
        <div>
          <div class="title" style="color:#5b21b6">Voces del Anime</div>
          <p>Prototipo conceptual para aprendizaje de lengua y cultura japonesa a través del anime.</p>
        </div>
        <div>
          <div class="title" style="color:#5b21b6">Enlaces</div>
          <ul style="margin:0;padding-left:18px">
            <li><a href="contacto.html">Contacto</a></li>
            <li><a href="creditos.html">Créditos</a></li>
            <li><a href="politica.html">Política de uso educativo</a></li>
          </ul>
        </div>
        <div>
          <div class="title" style="color:#5b21b6">Acerca de</div>
          <p>Glosarios, cultura y comunidad listos para iterar.</p>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // --- Utilidades ---
    const $ = (s, el=document) => el.querySelector(s);
    const el = (tag, cls) => { const n = document.createElement(tag); if (cls) n.className = cls; return n; };
    const nowISO = () => new Date().toISOString();
    const uuid = () =>
      (crypto && crypto.randomUUID) ? crypto.randomUUID()
      : 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c=>{
          const r = Math.random()*16|0, v = c==='x'?r:(r&0x3|0x8); return v.toString(16);
        });
    const clone = obj => JSON.parse(JSON.stringify(obj));

    // --- Storage ---
    const STORAGE_KEY = 'voces_posts_v3'; // nueva versión
    let posts = [];
    try { posts = JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { posts = []; }
    const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));

    // Semillas si está vacío
    if (posts.length === 0) {
      posts = [
        { id: uuid(), author:'Luna', content:'Mi frase favorita: 『よろしくお願いします』 — abre puertas con buena onda y respeto.', createdAt: nowISO(), replies:[] },
        { id: uuid(), author:'Kai',  content:'Propongo un glosario colaborativo de 敬語 (keigo) con ejemplos de anime escolar.', createdAt: nowISO(), replies:[] },
        { id: uuid(), author:'Haru', content:'¿Alguien recomienda animes con diálogos claros para principiantes?', createdAt: nowISO(), replies:[] },
        { id: uuid(), author:'Mei',  content:'Podemos crear un banco de expresiones según situaciones (comer, saludar, disculparse).', createdAt: nowISO(), replies:[] },

      ];
      save();
    }

    // --- Estado de búsqueda ---
    let query = '';

    // --- Render de respuesta con editar/eliminar ---
    function renderReply(postId, r){
      const rEl = el('div','reply');

      const head = el('div','actions');
      const who = el('span','author'); who.textContent = r.author || 'Anónimo';
      head.appendChild(who);
      head.appendChild(el('span','sep'));
      const btnEdit = el('button','btn small ghost'); btnEdit.textContent = 'Editar';
      const btnDel  = el('button','btn small ghost'); btnDel.textContent  = 'Eliminar';
      head.append(btnEdit, btnDel);
      rEl.appendChild(head);

      const body = el('div'); body.textContent = r.content; rEl.appendChild(body);

      // Editar respuesta
      btnEdit.addEventListener('click', ()=>{
        const edit = el('div','edit-area');
        const inName = el('input'); inName.value = r.author || 'Anónimo';
        const inText = el('textarea'); inText.value = r.content;
        const row = el('div','actions');
        const ok = el('button','btn small'); ok.textContent='Guardar';
        const cancel = el('button','btn small ghost'); cancel.textContent='Cancelar';
        row.append(ok,cancel);
        edit.append(inName,inText,row);

        rEl.innerHTML = '';
        rEl.appendChild(edit);

        ok.addEventListener('click', ()=>{
          const a = inName.value.trim() || 'Anónimo';
          const c = inText.value.trim();
          if(!c) { inText.focus(); return; }
          const pIdx = posts.findIndex(p=>p.id===postId);
          if (pIdx>-1) {
            const rpIdx = posts[pIdx].replies.findIndex(x=>x.id===r.id);
            if (rpIdx>-1) {
              posts[pIdx].replies[rpIdx].author = a;
              posts[pIdx].replies[rpIdx].content = c;
              save(); renderAll();
            }
          }
        });
        cancel.addEventListener('click', renderAll);
      });

      // Eliminar respuesta
      btnDel.addEventListener('click', ()=>{
        if (!confirm('¿Eliminar esta respuesta?')) return;
        const pIdx = posts.findIndex(p=>p.id===postId);
        if (pIdx>-1) {
          posts[pIdx].replies = (posts[pIdx].replies||[]).filter(x=>x.id!==r.id);
          save(); renderAll();
        }
      });

      return rEl;
    }

    // --- Render de post con responder/editar/eliminar ---
    function renderPostCard(post){
      const card = el('div','card');
      const inner = el('div','card-inner');
      card.appendChild(inner);

      // Cabecera: autor + acciones
      const head = el('div','actions');
      const author = el('div','author'); author.textContent = post.author || 'Anónimo';
      head.appendChild(author);
      head.appendChild(el('span','sep'));
      const btnEdit = el('button','btn small ghost'); btnEdit.textContent='Editar';
      const btnDel  = el('button','btn small ghost'); btnDel.textContent ='Eliminar';
      head.append(btnEdit, btnDel);
      inner.appendChild(head);

      // Contenido
      const p = el('p'); p.textContent = post.content; inner.appendChild(p);

      // Contador
      const meta = el('div','meta'); meta.textContent = (post.replies?.length||0) === 1 ? '1 respuesta' : `${post.replies?.length||0} respuestas`;
      inner.appendChild(meta);

      // Respuestas existentes
      const repliesWrap = el('div','replies');
      (post.replies||[]).forEach(r => repliesWrap.appendChild(renderReply(post.id, r)));
      inner.appendChild(repliesWrap);

      // Form nueva respuesta (siempre visible)
      const form = el('form','reply-form');
      form.setAttribute('aria-label','Responder a la publicación');
      const inName = el('input'); inName.placeholder='Tu nombre (opcional)'; inName.name='replyAuthor';
      const inText = el('textarea'); inText.placeholder='Escribe tu respuesta...'; inText.name='replyContent';
      const row = el('div','actions');
      const btnSend = el('button','btn'); btnSend.type='submit'; btnSend.textContent='Responder';
      row.append(btnSend);
      form.append(inName,inText,row);
      inner.appendChild(form);

      // Responder
      form.addEventListener('submit',(e)=>{
        e.preventDefault();
        const a = inName.value.trim() || 'Anónimo';
        const c = inText.value.trim();
        if(!c){ inText.focus(); return; }
        const pIdx = posts.findIndex(x=>x.id===post.id);
        if (pIdx>-1){
          posts[pIdx].replies = posts[pIdx].replies || [];
          posts[pIdx].replies.push({ id: uuid(), author:a, content:c, createdAt: nowISO() });
          save(); renderAll();
        }
      });

      // Editar post
      btnEdit.addEventListener('click', ()=>{
        const edit = el('div','edit-area');
        const inAuthor = el('input'); inAuthor.value = post.author || 'Anónimo';
        const inContent = el('textarea'); inContent.value = post.content;
        const row = el('div','actions');
        const ok = el('button','btn small'); ok.textContent='Guardar';
        const cancel = el('button','btn small ghost'); cancel.textContent='Cancelar';
        row.append(ok,cancel);
        edit.append(inAuthor,inContent,row);

        inner.innerHTML = '';
        inner.appendChild(head);
        inner.appendChild(edit);

        ok.addEventListener('click', ()=>{
          const a = inAuthor.value.trim() || 'Anónimo';
          const c = inContent.value.trim();
          if(!c){ inContent.focus(); return; }
          const idx = posts.findIndex(x=>x.id===post.id);
          if (idx>-1){
            posts[idx].author = a;
            posts[idx].content = c;
            save(); renderAll();
          }
        });
        cancel.addEventListener('click', renderAll);
      });

      // Eliminar post
      btnDel.addEventListener('click', ()=>{
        if (!confirm('¿Eliminar esta publicación y sus respuestas?')) return;
        posts = posts.filter(x=>x.id!==post.id);
        save(); renderAll();
      });

      return card;
    }

    // --- Filtrado + render general ---
    const postsGrid = $('#postsGrid');
    const emptyMsg  = $('#emptyMsg');

    function getFilteredOrdered(){
      const q = (query||'').trim().toLowerCase();
      let list = clone(posts);
      list.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt)); // orden interno (no visible)
      if (!q) return list;
      return list.filter(p=>{
        const hayPost = (p.author||'').toLowerCase().includes(q) || (p.content||'').toLowerCase().includes(q);
        const hayReply = (p.replies||[]).some(r => (r.author||'').toLowerCase().includes(q) || (r.content||'').toLowerCase().includes(q));
        return hayPost || hayReply;
      });
    }

    function renderAll(){
      postsGrid.innerHTML = '';
      const data = getFilteredOrdered();
      emptyMsg.style.display = data.length ? 'none' : 'block';
      data.forEach(post => postsGrid.appendChild(renderPostCard(post)));
    }

    // --- Publicar ---
    const authorInput = $('#author');
    const contentInput = $('#content');
    const composeMsg  = $('#composeMsg');
    $('#btnPost').addEventListener('click', ()=>{
      const author = authorInput.value.trim() || 'Anónimo';
      const content = contentInput.value.trim();
      if (!content){
        composeMsg.textContent = 'Escribí algo para publicar.';
        contentInput.focus();
        return;
      }
      const post = { id: uuid(), author, content, createdAt: nowISO(), replies:[] };
      posts.push(post);
      save();
      authorInput.value = '';
      contentInput.value = '';
      composeMsg.textContent = '¡Publicado!';
      renderAll();
      setTimeout(()=> composeMsg.textContent = '', 1500);
    });

    // --- Búsqueda ---
    const searchInput = $('#searchInput');
    const clearSearch = $('#clearSearch');
    searchInput.addEventListener('input', ()=>{
      query = searchInput.value;
      renderAll();
    });
    clearSearch.addEventListener('click', ()=>{
      searchInput.value = '';
      query = '';
      renderAll();
      searchInput.focus();
    });

    // Inicial
    renderAll();
  </script>
</body>
</html>



